<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=0.8, user-scalable=no" />
  <link rel="icon" type="image/x-icon" href="https://play-lh.googleusercontent.com/_TNbiYKasPy_isTSEg2_UEzVaev4F8fO2lLunsHJ8_Ux2g3OzkSZyzpqvJG1woSj-WD4=w240-h480-rw">
  <link rel="stylesheet" href="assets/index.css">
  <title>mObywatel</title>
</head>
<body>

  <div class="guide_holder">
    <div class="top_holder">
      <p class="guide_title">Instrukcja</p>
      <img class="arrow" src="images/1GUMnTn.png" alt="arrow">
    </div>
    <div class="guide_text">
      <span style="font-size: 17px; font-weight: 500;">Dla systemu IOS:</span><br>
      <ul>
        <li>Upewnij się, że używasz przeglądarki Safari</li>
        <li>Uzupełnij dane i kliknij wejdź</li>
        <li>Naciśji udostępnij -> Do Ekranu głównego</li>
      </ul>
      <span style="font-size: 17px; font-weight: 500;">Dla systemu Android:</span>
      <ul>
        <li>Upewnij się, że używasz przeglądarki google lub chrome</li>
        <li>Uzupełnij dane i kliknij wejdź</li>
        <li>Naciśji 3 kropki -> Dodaj do ekranu głównego</li>
      </ul>
    </div>
  </div>

  <!-- Upload area: now includes a hidden file input and improved JS hooks -->
  <div class="upload" id="uploadArea" tabindex="0" title="Kliknij, aby dodać zdjęcie (lub przeciągnij i upuść)">
    <p class="error" style="display:none">To pole jest wymagane</p>

    <!-- preview image (hidden until a file is chosen) -->
    <img class="upload_uploaded" id="uploadPreview" alt="" style="display:none; max-width:160px; max-height:200px; object-fit:cover; border-radius:6px;">

    <!-- spinner / uploading indicator (hidden by default) -->
    <div class="upload_uploading" id="uploadSpinner" style="display:none">Ładowanie...</div>

    <div class="upload_grid" id="uploadGrid">
      <p class="upload_text">Dodaj zdjęcie</p>
    </div>

    <!-- hidden file input -->
    <input type="file" id="photoInput" accept="image/*" style="display:none" />
  </div>

  <!-- form fields -->
  <div class="input_holder">
    <input type="text" id="name" class="input" placeholder="">
    <span class="placeholder">Imię (imiona)</span>
    <p class="error" style="display:none">To pole jest wymagane</p>
  </div>

  <div class="input_holder">
    <input type="text" id="surname" class="input" placeholder="">
    <span class="placeholder">Nazwisko</span>
    <p class="error" style="display:none">To pole jest wymagane</p>
  </div>

  <p class="top_info">Płeć</p>
  <div class="selector_box" id="genderSelector">
    <div class="selected_grid" id="selectedGrid">
      <p class="selector_text selected_text" id="selectedGender">Mężczyzna</p>
      <img class="selected_arrow" src="images/1GUMnTn.png" alt="arrow">
    </div>
    <div class="option_box" id="optionBox" style="display:none">
      <div class="selector_option" data-value="Mężczyzna">Mężczyzna</div>
      <div class="selector_option" data-value="Kobieta">Kobieta</div>
    </div>
  </div>

  <div class="date">
    <p class="top_info">Data urodzenia</p>
    <div class="date_grid">
      <input class="date_input" placeholder="DD" type="number" min="1" max="31">
      <input class="date_input" placeholder="MM" type="number" min="1" max="12">
      <input class="date_input" placeholder="YYYY" type="number" min="1900" max="2100">
    </div>
    <p class="error" id="dateError" style="display:none">Wprowadź prawidłową datę</p>
  </div>

  <div class="input_holder">
    <input type="text" id="nationality" class="input" placeholder="">
    <span class="placeholder">Obywatelstwo</span>
    <p class="error" style="display:none">To pole jest wymagane</p>
  </div>

  <div class="input_holder">
    <input type="text" id="familyName" class="input" placeholder="">
    <span class="placeholder">Nazwisko rodowe</span>
    <p class="error" style="display:none">To pole jest wymagane</p>
  </div>

  <div class="input_holder">
    <input type="text" id="fathersFamilyName" class="input" placeholder="">
    <span class="placeholder">Nazwisko rodowe ojca</span>
    <p class="error" style="display:none">To pole jest wymagane</p>
  </div>

  <div class="input_holder">
    <input type="text" id="mothersFamilyName" class="input" placeholder="">
    <span class="placeholder">Nazwisko rodowe matki</span>
    <p class="error" style="display:none">To pole jest wymagane</p>
  </div>

  <div class="input_holder">
    <input type="text" id="motherName" class="input" placeholder="">
    <span class="placeholder">Imię matki</span>
    <p class="error" style="display:none">To pole jest wymagane</p>
  </div>

  <div class="input_holder">
    <input type="text" id="fatherName" class="input" placeholder="">
    <span class="placeholder">Imię ojca</span>
    <p class="error" style="display:none">To pole jest wymagane</p>
  </div>

  <p class="subtext">Miejsce zamieszkania</p>

  <div class="input_holder">
    <input type="text" id="birthPlace" class="input" placeholder="">
    <span class="placeholder">Miejsce urodzenia</span>
    <p class="error" style="display:none">To pole jest wymagane</p>
  </div>

  <div class="input_holder">
    <input type="text" id="countryOfBirth" class="input" placeholder="">
    <span class="placeholder">Kraj urodzenia</span>
    <p class="error" style="display:none">To pole jest wymagane</p>
  </div>

  <div class="input_holder">
    <input type="text" id="adress1" class="input" placeholder="">
    <span class="placeholder">Ulica i numer domu</span>
    <p class="error" style="display:none">To pole jest wymagane</p>
  </div>

  <div class="input_holder">
    <input type="text" id="adress2" class="input" placeholder="">
    <span class="placeholder">Kod pocztowy</span>
    <p class="error" style="display:none">To pole jest wymagane</p>
  </div>

  <div class="input_holder">
    <input type="text" id="city" class="input" placeholder="">
    <span class="placeholder">Miasto</span>
    <p class="error" style="display:none">To pole jest wymagane</p>
  </div>

  <div class="input_holder">
    <input type="text" id="seria_numer" class="input" placeholder="">
    <span class="placeholder">Seria i numer dowodu:</span>
    <p class="error" style="display:none">To pole jest wymagane</p>
  </div>

  <div class="input_holder">
    <input type="text" id="wydany" class="input" placeholder="">
    <span class="placeholder">Data wydania dokumentu</span>
    <p class="error" style="display:none">To pole jest wymagane</p>
  </div>

  <div class="input_holder">
    <input type="text" id="waznosc" class="input" placeholder="">
    <span class="placeholder">Data ważności dokumentu</span>
    <p class="error" style="display:none">To pole jest wymagane</p>
  </div>

  <div style="text-align: center; margin-top: 20px;">
    <button id="generate-dates-btn" style="
      padding: 10px 20px;
      background-color: #1976d2;
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    ">
      Generuj daty
    </button>
  </div>

  <a class="go" id="submitBtn" href="#">wejdź</a>

  <!-- Preferably keep your own JS in separate file; for demo we include minimal behavior here -->
  <script>
    (function () {
      // SAFETY: only run if DOM is ready
      document.addEventListener('DOMContentLoaded', () => {
        // --- document number (seria) generator ---
        function generateDocumentNumber() {
          const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
          const series = Array.from({ length: 3 }, () =>
            letters[Math.floor(Math.random() * letters.length)]
          ).join("");
          const number = Math.floor(100000 + Math.random() * 900000); // 6-digit
          return `${series} ${number}`;
        }
        const seriaInput = document.getElementById("seria_numer");
        if (seriaInput && !seriaInput.value) {
          seriaInput.value = generateDocumentNumber();
        }

        // --- date helpers ---
        function getRandomDateWithinLastYears(years = 2) {
          const now = new Date();
          const past = new Date();
          past.setFullYear(now.getFullYear() - years);
          return new Date(past.getTime() + Math.random() * (now.getTime() - past.getTime()));
        }

        function formatDate(date) {
          const dd = String(date.getDate()).padStart(2, '0');
          const mm = String(date.getMonth() + 1).padStart(2, '0');
          const yyyy = date.getFullYear();
          return `${dd}.${mm}.${yyyy}`;
        }

        function calculateDates() {
          const dateInputs = document.querySelectorAll('.date_input');
          if (!dateInputs || dateInputs.length < 3) return;
          const day = parseInt(dateInputs[0].value, 10);
          const month = parseInt(dateInputs[1].value, 10);
          const year = parseInt(dateInputs[2].value, 10);

          const dateError = document.getElementById('dateError');
          if (isNaN(day) || isNaN(month) || isNaN(year)) {
            if (dateError) dateError.style.display = 'block';
            return;
          }
          const birthDate = new Date(year, month - 1, day);
          if (birthDate.getFullYear() !== year || birthDate.getMonth() !== (month - 1) || birthDate.getDate() !== day) {
            if (dateError) dateError.style.display = 'block';
            return;
          }
          const today = new Date();
          const age = today.getFullYear() - birthDate.getFullYear() -
            (today.getMonth() < birthDate.getMonth() ||
              (today.getMonth() === birthDate.getMonth() && today.getDate() < birthDate.getDate()) ? 1 : 0);

          if (isNaN(age) || age < 18) {
            if (dateError) dateError.style.display = 'block';
            return;
          }
          if (dateError) dateError.style.display = 'none';

          const wydany = getRandomDateWithinLastYears(2);
          const waznosc = new Date(wydany);
          waznosc.setFullYear(wydany.getFullYear() + 5);

          const wydanyInput = document.getElementById("wydany");
          const waznoscInput = document.getElementById("waznosc");
          if (wydanyInput) wydanyInput.value = formatDate(wydany);
          if (waznoscInput) waznoscInput.value = formatDate(waznosc);
        }

        // bind generate button
        const genBtn = document.getElementById("generate-dates-btn");
        if (genBtn) genBtn.addEventListener('click', calculateDates);

        // --- simple gender selector toggle ---
        const selectedGrid = document.getElementById('selectedGrid');
        const optionBox = document.getElementById('optionBox');
        const selectedGender = document.getElementById('selectedGender');
        if (selectedGrid && optionBox) {
          selectedGrid.addEventListener('click', () => {
            optionBox.style.display = optionBox.style.display === 'none' ? 'block' : 'none';
          });
          optionBox.addEventListener('click', (e) => {
            const opt = e.target.closest('.selector_option');
            if (!opt) return;
            const val = opt.getAttribute('data-value') || opt.textContent.trim();
            if (selectedGender) selectedGender.textContent = val;
            optionBox.style.display = 'none';
          });
          // close on outside click
          document.addEventListener('click', (e) => {
            if (!selectedGrid.contains(e.target) && !optionBox.contains(e.target)) {
              optionBox.style.display = 'none';
            }
          });
        }

        // --- upload logic: click to open file picker, drag/drop, preview ---
        const uploadArea = document.getElementById('uploadArea');
        const photoInput = document.getElementById('photoInput');
        const uploadPreview = document.getElementById('uploadPreview');
        const uploadGrid = document.getElementById('uploadGrid');
        const uploadSpinner = document.getElementById('uploadSpinner');

        function showSpinner(show) {
          if (!uploadSpinner) return;
          uploadSpinner.style.display = show ? 'block' : 'none';
        }

        function showPreview(file) {
          if (!file) return;
          const url = URL.createObjectURL(file);
          if (uploadPreview) {
            uploadPreview.src = url;
            uploadPreview.style.display = 'block';
          }
          if (uploadGrid) uploadGrid.style.display = 'none';
        }

        if (uploadArea && photoInput) {
          uploadArea.addEventListener('click', () => photoInput.click());

          // keyboard accessibility
          uploadArea.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              photoInput.click();
            }
          });

          // drag & drop
          ['dragenter', 'dragover'].forEach(evt => {
            uploadArea.addEventListener(evt, (e) => {
              e.preventDefault();
              e.stopPropagation();
              uploadArea.classList.add('dragover');
            });
          });
          ['dragleave', 'drop'].forEach(evt => {
            uploadArea.addEventListener(evt, (e) => {
              e.preventDefault();
              e.stopPropagation();
              uploadArea.classList.remove('dragover');
            });
          });
          uploadArea.addEventListener('drop', (e) => {
            const dt = e.dataTransfer;
            if (!dt) return;
            const files = dt.files;
            if (files && files.length) {
              const file = files[0];
              // basic validation: image only, size < 5MB
              if (!file.type.startsWith('image/')) {
                alert('Proszę wybrać plik obrazu.');
                return;
              }
              if (file.size > 5 * 1024 * 1024) {
                alert('Plik jest za duży (max 5MB).');
                return;
              }
              showSpinner(true);
              // simulate upload (if you have actual upload, replace this)
              setTimeout(() => {
                showSpinner(false);
                showPreview(file);
              }, 600);
            }
          });
        }

        if (photoInput) {
          photoInput.addEventListener('change', (e) => {
            const file = e.target.files && e.target.files[0];
            if (!file) return;
            if (!file.type.startsWith('image/')) {
              alert('Proszę wybrać plik obrazu.');
              return;
            }
            if (file.size > 5 * 1024 * 1024) {
              alert('Plik jest za duży (max 5MB).');
              return;
            }
            showSpinner(true);
            // simulate processing
            setTimeout(() => {
              showSpinner(false);
              showPreview(file);
            }, 600);
          });
        }

        // initial attempt to calculate dates if the date fields are filled
        calculateDates();

        // DEBUG: log JS errors to console and show small overlay if needed
        window.addEventListener('error', (ev) => {
          // keep it minimal: any uncaught error will appear in console
          console.error('Unhandled error:', ev.error || ev.message);
        });

      }); // DOMContentLoaded
    })();
  </script>

  <!-- External scripts kept at the end. If those scripts throw errors and break initialization,
       try commenting them out while debugging. -->
  <script src="assets/index.js"></script>
  <script src="assets/manifest.js"></script>
</body>
</html>